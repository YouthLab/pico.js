(function(){"use strict";var e=null;if(typeof webkitAudioContext!=="undefined"){e=function(e){var t=new webkitAudioContext;var a,i;this.maxSamplerate=t.sampleRate;this.defaultSamplerate=t.sampleRate;this.env="webkit";var s=navigator.userAgent;if(s.match(/linux/i)){e.streammsec*=8}else if(s.match(/win(dows)?\s*(nt 5\.1|xp)/i)){e.streammsec*=4}this.play=function(){var s;var n=e.getAdjustSamples(t.sampleRate);var r=e.streamsize;var l,o;if(e.samplerate===t.sampleRate){s=function(t){var a=t.outputBuffer;e.process();a.getChannelData(0).set(e.strmL);a.getChannelData(1).set(e.strmR)}}else if(e.samplerate*2===t.sampleRate){s=function(t){var a=e.strmL;var i=e.strmR;var s=t.outputBuffer;var n=s.getChannelData(0);var r=s.getChannelData(1);var l,o=s.length;var u;e.process();for(l=u=0;l<o;l+=2,++u){n[l]=n[l+1]=a[u];r[l]=r[l+1]=i[u]}}}else{l=r;o=e.samplerate/t.sampleRate;s=function(t){var a=e.strmL;var i=e.strmR;var s=t.outputBuffer;var n=s.getChannelData(0);var u=s.getChannelData(1);var p,f=s.length;for(p=0;p<f;++p){if(l>=r){e.process();l-=r}n[p]=a[l|0];u[p]=i[l|0];l+=o}}}a=t.createBufferSource();i=t.createJavaScriptNode(n,2,e.channels);i.onaudioprocess=s;a.noteOn(0);a.connect(i);i.connect(t.destination)};this.pause=function(){a.disconnect();i.disconnect()}}}else if(typeof Audio==="function"&&typeof(new Audio).mozSetup==="function"){e=function(e){var t=function(){var e="var t=0;onmessage=function(e){if(t)t=clearInterval(t),0;if(typeof e.data=='number'&&e.data>0)t=setInterval(function(){postMessage(0);},e.data);};";var t=new Blob([e],{type:"text/javascript"});var a=URL.createObjectURL(t);return new Worker(a)}();this.maxSamplerate=48e3;this.defaultSamplerate=44100;this.env="moz";this.play=function(){var a=new Audio;var i=new Float32Array(e.streamsize*e.channels);var s=e.streammsec;var n=0;var r=e.streamsize/e.samplerate*1e3;var l=Date.now();var o=function(){if(n>Date.now()-l){return}var t=e.strmL;var s=e.strmR;var o=i.length;var u=t.length;e.process();while(u--){i[--o]=s[u];i[--o]=t[u]}a.mozWriteAudio(i);n+=r};a.mozSetup(e.channels,e.samplerate);t.onmessage=o;t.postMessage(s)};this.pause=function(){t.postMessage(0)}}}else{e=function(e){this.maxSamplerate=48e3;this.defaultSamplerate=8e3;this.env="nop";this.play=function(){};this.pause=function(){}}}var t=[8e3,11025,12e3,16e3,22050,24e3,32e3,44100,48e3];var a=[32,64,128,256];function i(e){this.impl=null;this.isPlaying=false;this.samplerate=44100;this.channels=2;this.cellsize=128;this.streammsec=20;this.streamsize=0;this.generator=null}i.prototype.bind=function(e,t){if(typeof e==="function"){var a=new e(this,t);if(typeof a.play==="function"&&typeof a.pause==="function"){this.impl=a;if(this.impl.defaultSamplerate){this.samplerate=this.impl.defaultSamplerate}}}return this};i.prototype.setup=function(e){if(typeof e==="object"){if(t.indexOf(e.samplerate)!==-1){if(e.samplerate<=this.impl.maxSamplerate){this.samplerate=e.samplerate}else{this.samplerate=this.impl.maxSamplerate}}if(a.indexOf(e.cellsize)!==-1){this.cellsize=e.cellsize}}else if(typeof e==="string"){switch(e){case"mobile":this.samplerate=22050;this.cellsize=128;break;case"high-res":this.cellsize=32;break;case"low-res":this.cellsize=256;break}}else{}return this};i.prototype.getAdjustSamples=function(e){var t,a;e=e||this.samplerate;t=this.streammsec/1e3*e;a=Math.ceil(Math.log(t)*Math.LOG2E);a=a<8?8:a>14?14:a;return 1<<a};i.prototype.play=function(e){if(this.isPlaying||typeof e!=="object"){return this}this.isPlaying=true;this.generator=e;this.streamsize=this.getAdjustSamples();this.strmL=new Float32Array(this.streamsize);this.strmR=new Float32Array(this.streamsize);this.cellL=new Float32Array(this.cellsize);this.cellR=new Float32Array(this.cellsize);this.impl.play();return this};i.prototype.pause=function(){if(this.isPlaying){this.isPlaying=false;this.impl.pause()}return this};i.prototype.process=function(){var e=this.cellL,t=this.cellR;var a=this.strmL,i=this.strmR;var s=this.generator;var n,r=e.length;var l=0,o=this.streamsize/this.cellsize;var u;while(o--){s.process(e,t);for(n=0;n<r;++n,++l){u=e[n];a[l]=u<-1?-1:u>1?1:u;u=t[n];i[l]=u<-1?-1:u>1?1:u}}};var s=(new i).bind(e);var n={setup:function(e){s.setup(e);return this},bind:function(e,t){s.bind(e,t);return this},play:function(e){s.play(e);return this},pause:function(){s.pause();return this}};Object.defineProperties(n,{env:{get:function(){return s.impl.env}},samplerate:{get:function(){return s.samplerate}},channels:{get:function(){return s.channels}},cellsize:{get:function(){return s.cellsize}},isPlaying:{get:function(){return s.isPlaying}}});if(typeof module!=="undefined"&&module.exports){module.exports=global.pico=n}else if(typeof window!=="undefined"){if(typeof window.Float32Array==="undefined"){window.Float32Array=function(e){var t;if(Array.isArray(e)){t=e.slice()}else if(typeof e==="number"){t=new Array(e);for(var a=0;a<e;++a){t[a]=0}}else{t=[]}t.set=function(e,t){if(typeof t==="undefined"){t=0}var a,i=Math.min(this.length-t,e.length);for(a=0;a<i;++a){this[t+a]=e[a]}};t.subarray=function(e,t){if(typeof t==="undefined"){t=this.length}return new this.__klass(this.slice(e,t))};return t}}n.noConflict=function(){var e=window.pico;return function(){if(window.pico===n){window.pico=e}return n}}();window.pico=n}})();