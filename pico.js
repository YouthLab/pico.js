(function(){"use strict";function e(){this.impl=null,this.isPlaying=!1,this.samplerate=44100,this.channels=2,this.cellsize=128,this.streammsec=20,this.streamsize=0,this.generator=null}var t=null,a=function(){return"undefined"!=typeof window?window.webkitAudioContext||window.AudioContext:void 0}();a!==void 0?t=function(e){var t,i,n=new a;this.maxSamplerate=n.sampleRate,this.defaultSamplerate=n.sampleRate,this.env="webkit";var s=navigator.userAgent;s.match(/linux/i)?e.streammsec*=8:s.match(/win(dows)?\s*(nt 5\.1|xp)/i)&&(e.streammsec*=4),this.play=function(){var a,s,r,o=e.getAdjustSamples(n.sampleRate),l=e.streamsize;e.samplerate===n.sampleRate?a=function(t){var a=t.outputBuffer;e.process(),a.getChannelData(0).set(e.strmL),a.getChannelData(1).set(e.strmR)}:2*e.samplerate===n.sampleRate?a=function(t){var a,i,n=e.strmL,s=e.strmR,r=t.outputBuffer,o=r.getChannelData(0),l=r.getChannelData(1),c=r.length;for(e.process(),a=i=0;c>a;a+=2,++i)o[a]=o[a+1]=n[i],l[a]=l[a+1]=s[i]}:(s=l,r=e.samplerate/n.sampleRate,a=function(t){var a,i=e.strmL,n=e.strmR,o=t.outputBuffer,c=o.getChannelData(0),u=o.getChannelData(1),p=o.length;for(a=0;p>a;++a)s>=l&&(e.process(),s-=l),c[a]=i[0|s],u[a]=n[0|s],s+=r}),t=n.createBufferSource(),i=n.createJavaScriptNode(o,2,e.channels),i.onaudioprocess=a,t.noteOn(0),t.connect(i),i.connect(n.destination)},this.pause=function(){t.disconnect(),i.disconnect()}}:"function"==typeof Audio&&"function"==typeof(new Audio).mozSetup?t=function(e){var t=function(){var e="var t=0;onmessage=function(e){if(t)t=clearInterval(t),0;if(typeof e.data=='number'&&e.data>0)t=setInterval(function(){postMessage(0);},e.data);};",t=new Blob([e],{type:"text/javascript"}),a=window.URL.createObjectURL(t);return new Worker(a)}();this.maxSamplerate=48e3,this.defaultSamplerate=44100,this.env="moz",this.play=function(){var a=new Audio,i=new Float32Array(e.streamsize*e.channels),n=e.streammsec,s=0,r=1e3*(e.streamsize/e.samplerate),o=Date.now(),l=function(){if(!(s>Date.now()-o)){var t=e.strmL,n=e.strmR,l=i.length,c=t.length;for(e.process();c--;)i[--l]=n[c],i[--l]=t[c];a.mozWriteAudio(i),s+=r}};a.mozSetup(e.channels,e.samplerate),t.onmessage=l,t.postMessage(n)},this.pause=function(){t.postMessage(0)}}:(function(){function e(e){var t=0;a(),this.maxSamplerate=44100,this.defaultSamplerate=44100,this.env="flash",this.play=function(){var a,i=Array(e.streamsize*e.channels),n=e.streammsec,r=0,l=1e3*(e.streamsize/e.samplerate),c=Date.now();a=function(){if(!(r>Date.now()-c)){var t=e.strmL,a=e.strmR,n=i.length,o=t.length;for(e.process();o--;)i[--n]=0|32768*a[o],i[--n]=0|32768*t[o];s.writeAudio(i.join(" ")),r+=l}},s.setup?(s.setup(e.channels,e.samplerate),t=setInterval(a,n)):console.warn("Cannot find "+o)},this.pause=function(){0!==t&&(s.cancel(),clearInterval(t),t=0)}}function a(){var e,t,a=o,i=a+"?"+ +new Date,l="PicoFlashPlayer",c=document.createElement("div");c.id=r,c.style.display="inline",c.width=c.height=1,n.plugins&&n.mimeTypes&&n.mimeTypes.length?(e=document.createElement("object"),e.id=l,e.classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",e.width=e.height=1,e.setAttribute("data",i),e.setAttribute("type","application/x-shockwave-flash"),t=document.createElement("param"),t.setAttribute("name","allowScriptAccess"),t.setAttribute("value","always"),e.appendChild(t),c.appendChild(e)):(e='<object id="'+l+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1">',e+='<param name="movie" value="'+i+'" />',e+='<param name="bgcolor" value="#FFFFFF" />',e+='<param name="quality" value="high" />',e+='<param name="allowScriptAccess" value="always" />',e+="</object>",c.innerHTML=e),window.addEventListener("load",function(){document.body.appendChild(c),s=document[l]})}function i(e){try{return n.plugins&&n.mimeTypes&&n.mimeTypes.length?n.plugins["Shockwave Flash"].description.match(/([0-9]+)/)[e]:new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").match(/([0-9]+)/)[e]}catch(t){return-1}}if("undefined"!=typeof window){var n=navigator;if(!(10>i(0))){var s,r="PicoFlashPlayerDiv",o=function(){var e=document.getElementsByTagName("script");if(e&&e.length)for(var t,a=0,i=e.length;i>a;++a)if(t=/^(.*\/)pico(.*)\.js$/i.exec(e[a].src))return t[1]+"pico.swf"}();t=e}}}(),t||(t=function(){this.maxSamplerate=48e3,this.defaultSamplerate=8e3,this.env="nop",this.play=function(){},this.pause=function(){}}));var i=[8e3,11025,12e3,16e3,22050,24e3,32e3,44100,48e3],n=[32,64,128,256];e.prototype.bind=function(e,t){if("function"==typeof e){var a=new e(this,t);"function"==typeof a.play&&"function"==typeof a.pause&&(this.impl=a,this.impl.defaultSamplerate&&(this.samplerate=this.impl.defaultSamplerate))}return this},e.prototype.setup=function(e){if("object"==typeof e)-1!==i.indexOf(e.samplerate)&&(this.samplerate=e.samplerate<=this.impl.maxSamplerate?e.samplerate:this.impl.maxSamplerate),-1!==n.indexOf(e.cellsize)&&(this.cellsize=e.cellsize);else if("string"==typeof e)switch(e){case"mobile":this.samplerate=22050,this.cellsize=128;break;case"high-res":this.cellsize=32;break;case"low-res":this.cellsize=256}return this},e.prototype.getAdjustSamples=function(e){var t,a;return e=e||this.samplerate,t=this.streammsec/1e3*e,a=Math.ceil(Math.log(t)*Math.LOG2E),a=8>a?8:a>14?14:a,1<<a},e.prototype.play=function(e){return this.isPlaying||"object"!=typeof e?this:(this.isPlaying=!0,this.generator=e,this.streamsize=this.getAdjustSamples(),this.strmL=new Float32Array(this.streamsize),this.strmR=new Float32Array(this.streamsize),this.cellL=new Float32Array(this.cellsize),this.cellR=new Float32Array(this.cellsize),this.impl.play(),this)},e.prototype.pause=function(){return this.isPlaying&&(this.isPlaying=!1,this.impl.pause()),this},e.prototype.process=function(){for(var e,t,a=this.cellL,i=this.cellR,n=this.strmL,s=this.strmR,r=this.generator,o=a.length,l=0,c=this.streamsize/this.cellsize;c--;)for(r.process(a,i),e=0;o>e;++e,++l)t=a[e],n[l]=-1>t?-1:t>1?1:t,t=i[e],s[l]=-1>t?-1:t>1?1:t};var s=(new e).bind(t),r={setup:function(e){return s.setup(e),this},bind:function(e,t){return s.bind(e,t),this},play:function(e){return s.play(e),this},pause:function(){return s.pause(),this}};Object.defineProperties(r,{env:{get:function(){return s.impl.env}},samplerate:{get:function(){return s.samplerate}},channels:{get:function(){return s.channels}},cellsize:{get:function(){return s.cellsize}},isPlaying:{get:function(){return s.isPlaying}}}),"undefined"!=typeof module&&module.exports?module.exports=global.pico=r:"undefined"!=typeof window&&(window.Float32Array===void 0&&(window.Float32Array=function(e){var t;if(Array.isArray(e))t=e.slice();else if("number"==typeof e){t=Array(e);for(var a=0;e>a;++a)t[a]=0}else t=[];return t.set=function(e,t){t===void 0&&(t=0);var a,i=Math.min(this.length-t,e.length);for(a=0;i>a;++a)this[t+a]=e[a]},t.subarray=function(e,t){return t===void 0&&(t=this.length),this.slice(e,t)},t}),r.noConflict=function(){var e=window.pico;return function(){return window.pico===r&&(window.pico=e),r}}(),window.pico=r)})();
//@ sourceMappingURL=pico.js.map